<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Daftar Admin</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="img/favicon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="admin/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="admin/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="admin/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="admin/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="admin/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="admin/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="admin/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="admin/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: May 30 2023 with Bootstrap v5.3.0
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="dashboard" class="logo d-flex align-items-center">
        <img src="img/logo.png" alt="">
        <span class="d-none d-lg-block">Desa Bendo</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <!-- <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> -->
    <!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bi bi-search"></i>
          </a>
        </li><!-- End Search Icon-->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <span class="d-none d-md-block dropdown-toggle ps-2" id="main-profile"></span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6 id="profile-username"></h6>
              <span id="profile-role"></span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="#" onclick="LogOut('{{.url}}login')">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed" href="dashboard">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#forms-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-journal-text"></i><span>Pengajuan</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="forms-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="surat-domisili">
              <i class="bi bi-circle"></i><span>Surat Domisili</span>
            </a>
          </li>
          <li>
            <a href="forms-layouts.html">
              <i class="bi bi-circle"></i><span>Kartu Keluarga</span>
            </a>
          </li>
          <li>
            <a href="forms-editors.html">
              <i class="bi bi-circle"></i><span>Form Editors</span>
            </a>
          </li>
          <li>
            <a href="forms-validation.html">
              <i class="bi bi-circle"></i><span>Form Validation</span>
            </a>
          </li>
        </ul>
      </li><!-- End Forms Nav -->

      <li class="nav-item" id="daftarAdmin" style="display: none;">
        <a class="nav-link collapsed" href="daftar-admin">
          <i class="bi bi-gear"></i>
          <span>Daftar Admin</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="daftar-user">
          <i class="bi bi-people"></i>
          <span>Daftar User</span>
        </a>
      </li><!-- End Dashboard Nav -->
    </ul>

  </aside><!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Admin</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="dashboard">Home</a></li>
          <li class="breadcrumb-item active">Daftar Admin</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- Recent Sales -->
            <div class="col-12">
              <div class="card recent-sales overflow-auto">

                <div class="filter" style="right: 25px;" id="buttonTambahAdmin">
                  <!-- <button type="button" class="btn btn-primary" onclick="tambahAdmin()">
                    <i class="bi bi-plus me-1"></i> Tambah
                  </button> -->
                </div>

                <div class="card-body">
                  <h5 class="card-title">List Admin</h5>

                  <table class="table table-borderless datatable" id="myTable">
                    <thead>
                      <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Nama</th>
                        <th scope="col">Email</th>
                        <th scope="col">Status</th>
                        <th scope="col">Tanggal dibuat</th>
                        <th scope="col">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="tableBody">
                      <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                      </tr>
                      <!-- Table rows will be added here dynamically -->
                    </tbody>
                  </table>

                </div>

              </div>
            </div><!-- End Recent Sales -->

          </div>
        </div><!-- End Left side columns -->

      </div>
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>NiceAdmin</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      <!-- <a href="https://bootstrapmade.com/">BootstrapMade</a> -->
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="admin/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="admin/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="admin/vendor/chart.js/chart.umd.js"></script>
  <script src="admin/vendor/echarts/echarts.min.js"></script>
  <script src="admin/vendor/quill/quill.min.js"></script>
  <script src="admin/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="admin/vendor/tinymce/tinymce.min.js"></script>
  <script src="admin/vendor/php-email-form/validate.js"></script>


  <!-- Template Main JS File -->
  <script src="admin/js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    const url = '{{.url}}'
    validateTokenSuper(url).then((isValid) => {
      daftarAmdin = document.getElementById("daftarAdmin")
      if (!isValid) {
        daftarAmdin.style.display = "none"
        RedirectLogin(url + "login")
      } else {
        daftarAmdin.style.display = "block"
        profile = document.getElementById("profileDrowpdown")
        profile.textContent += GetUsername()
      }
    })


    function createButton() {
      const buttonBody = document.getElementById("buttonTambahAdmin")
      if (GetRole() === "super") {
        console.log(GetRole());
        const button = document.createElement("button")
        button.textContent += "Tambah"
        const i = document.createElement("i")
        button.setAttribute("type", "button")
        button.setAttribute("onclick", "tambahAdmin()")
        button.setAttribute("class", "btn btn-primary")
        i.setAttribute("class", "bi bi-plus me-1")
        button.appendChild(i)
        buttonBody.appendChild(button)
      }
    }

    function createTable(data) {
      const cardBodyTable = document.getElementById("cardBodyTable")

      const tableBody = document.getElementById("tableBody");


      data.forEach((item, index) => {
        const row = document.createElement("tr");

        // Column 1 - #
        const column1 = document.createElement("th");
        column1.setAttribute("scope", "row");
        column1.textContent = (item.id);
        row.appendChild(column1);

        // Column 2 - Username
        const column2 = document.createElement("td");
        column2.textContent = item.username;
        row.appendChild(column2);

        // Column 3 - Email
        const column3 = document.createElement("td");
        column3.textContent = item.email;
        row.appendChild(column3);



        // Column 5 - Status
        const column5 = document.createElement("td");
        const span5 = document.createElement("span")
        if (item.is_active == "Aktif") {
          span5.setAttribute("class", "badge bg-success")
        } else {
          span5.setAttribute("class", "badge bg-danger")
        }
        span5.textContent = item.is_active;
        column5.appendChild(span5)
        row.appendChild(column5);

        // Column 6 - Created At
        const column6 = document.createElement("td");
        column6.textContent = item.created_at;
        row.appendChild(column6);

        // Column 7 - Updated At
        const column7 = document.createElement("td");
        if (GetRole() === "super") {
          const newColumn7 = document.createElement("button")
          if (item.is_active == "Tidak Aktif") {
            column7.appendChild(newColumn7).className = "btn btn-success"
            newColumn7.setAttribute("type", "button")
            newColumn7.setAttribute("data-bs-toggle", "tooltip")
            newColumn7.setAttribute("data-bs-placement", "top")
            newColumn7.setAttribute("data-bs-original-title", "Aktifasi")
            newColumn7.onclick = function () {
              let id = item.id
              return fetch(`${url}activation-admin/${id}`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "Authorization": `Bearer ${GetToken()}`,
                },
              })
                .then((response) => {
                  return response.json()
                })
                .then((data) => {
                  if (data.code == 401) {
                    RedirectLogin(url)
                  }
                  if (data.code != 200) {
                    throw new Error(data.message)
                  }

                  let redirectUrl = `${url}login`
                  const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                      toast.addEventListener('mouseenter', Swal.stopTimer)
                      toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                  })

                  Toast.fire({
                    icon: 'success',
                    title: 'Akun berhasil di aktifasi'
                  }).then((result) => {
                    // Redirect the user to a new URL after the toast is shown
                    location.reload()
                  });
                })
                .catch(error => {
                  Swal.showValidationMessage(error.message)
                })
            }
            newColumn7.style.padding = "0px 6px"
            newColumn7.appendChild(document.createElement("i")).className = "bi bi-check"
          } else if (item.is_active == "Aktif") {
            newColumn7.onclick = function () {
              let id = item.id
              return fetch(`${url}in-active-admin/${id}`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "Authorization": `Bearer ${GetToken()}`,
                },
              })
                .then((response) => {
                  return response.json()
                })
                .then((data) => {
                  if (data.code == 401) {
                    RedirectLogin(url)
                  }
                  if (data.code != 200) {
                    throw new Error(data.message)
                  }

                  let redirectUrl = `${url}login`
                  const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                      toast.addEventListener('mouseenter', Swal.stopTimer)
                      toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                  })

                  Toast.fire({
                    icon: 'success',
                    title: 'Akun berhasil di non-aktifkan'
                  }).then((result) => {
                    // Redirect the user to a new URL after the toast is shown
                    location.reload()
                  });
                })
                .catch(error => {
                  Swal.showValidationMessage(error.message)
                })
            }
            newColumn7.style.padding = "0px 6px"
            newColumn7.appendChild(document.createElement("i")).className = "bi bi-x"
            column7.appendChild(newColumn7).className = "btn btn-danger"
          }
        }

        row.appendChild(column7);

        // Append the row to the table body
        tableBody.appendChild(row);
      });
    }

    SetProfile()

    async function tambahAdmin() {
      const { value: formValues } = await Swal.fire({
        title: 'Tambah Admin',
        html:
          '<input id="swal-input1" class="swal2-input" placeholder="username">' +
          '<input id="swal-input2" class="swal2-input" placeholder="email">' +
          '<br><i class="text-center">Password default adalah 123456</i>' ,

        focusConfirm: false,
        preConfirm: () => {
          let username = document.getElementById('swal-input1').value
          let email = document.getElementById('swal-input2').value

          if (username == "") {
            Swal.showValidationMessage("username harus diisi")
            return
          }

          if (email == "") {
            Swal.showValidationMessage("email harus diisi")
            return
          }

          const request = {
            username: username,
            email: email,
            password: "",
            role: 1
          }

          return fetch(`${url}tambah-admin`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${GetToken()}`,
            },
            body: JSON.stringify(request)
          })
            .then((response) => {
              return response.json()
            })
            .then((data) => {
              if (data.code == 401) {
                window.location.href = `${url}login`
              }
              if (data.code != 201) {
                throw new Error(data.message)
              }

              let redirectUrl = `${url}login`
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                didOpen: (toast) => {
                  toast.addEventListener('mouseenter', Swal.stopTimer)
                  toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
              })

              Toast.fire({
                icon: 'success',
                title: 'Akun berhasil ditambahkan'
              }).then((result) => {
                // Redirect the user to a new URL after the toast is shown
                location.reload()
              });
            })
            .catch(error => {
              Swal.showValidationMessage(error.message)
            })
        },
        allowOutsideClick: () => !Swal.isLoading()
      })

    }

    function getAdmin() {
      fetch(`${url}get-admin`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${GetToken()}`,
        },
      }).then((response) => {
        return response.json()
      }).then((data) => {
        createButton()
        createTable(data.data);
      }).catch((error) => {
        console.log(error);
      })
    }

    if (document.readyState === "complete") {
      // The DOM is fully loaded, you can proceed with your code here
      getAdmin();
    } else {
      // Wait for the DOM to load before executing your code
      document.addEventListener("DOMContentLoaded", function () {
        getAdmin();
      });
    }
  </script>
</body>

</html>